{{ define "title" }}Blog | {{ .Site.Title }}{{ end }}

{{ define "head" }}
<!-- Enhanced Meta Description -->
<meta name="description" content="Cybersecurity insights from Security Cocktail Hour. Industry trends, security operations, and practitioner perspectives.">

<!-- Schema.org Blog/CollectionPage Markup -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Security Cocktail Hour Blog",
  "description": "Cybersecurity insights, analysis, and practical guidance from industry practitioners",
  "url": "{{ .Permalink }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}"
  }{{ $posts := first 10 .Pages }}{{ if $posts }},
  "blogPost": [
    {{ range $index, $page := $posts }}{{ if $index }},{{ end }}
    {
      "@type": "BlogPosting",
      "headline": "{{ $page.Title }}",
      "url": "{{ $page.Permalink }}",
      "datePublished": "{{ $page.Date.Format "2006-01-02" }}",
      "description": "{{ with $page.Params.description }}{{ . }}{{ else }}{{ $page.Summary | plainify | truncate 160 }}{{ end }}"
    }{{ end }}
  ]{{ end }}
}
</script>

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="Blog | {{ .Site.Title }}">
<meta property="og:description" content="Browse our complete archive of cybersecurity insights, analysis, and practical guidance from Security Cocktail Hour.">
<meta property="og:site_name" content="{{ .Site.Title }}">

<!-- Twitter -->
<meta property="twitter:card" content="summary">
<meta property="twitter:url" content="{{ .Permalink }}">
<meta property="twitter:title" content="Blog | {{ .Site.Title }}">
<meta property="twitter:description" content="Browse our complete archive of cybersecurity insights, analysis, and practical guidance from Security Cocktail Hour.">
{{ end }}

{{ define "main" }}

<!-- Blog Hero -->
<section class="blog-hero">
  <div class="art-deco-pattern"></div>
  <div class="corner-accent corner-accent-tl"></div>
  <div class="corner-accent corner-accent-tr"></div>

  <div class="container">
    <div class="hero-content">
      <h1 class="hero-title">
        <span>Blog</span>
      </h1>
      <p class="hero-subtitle">
        Insights, analysis, and deep dives into cybersecurity topics from the Security Cocktail Hour team.
      </p>
    </div>
  </div>
</section>

<!-- Controls Section -->
<section class="controls-section">
  <div class="container">
    <div class="controls-grid-blog">
      <!-- Search -->
      <div class="search-container">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <input
          type="search"
          id="blog-search"
          class="search-input"
          placeholder="Search blog posts by title or content..."
        >
      </div>

      <!-- Category Filter -->
      <div class="select-group">
        <span class="select-label">Category:</span>
        <select id="category-filter" class="custom-select">
          <option value="">All Categories</option>
          {{ $categories := slice }}
          {{ range .Pages }}
            {{ with .Params.category }}
              {{ $categories = $categories | append . }}
            {{ end }}
          {{ end }}
          {{ range sort (uniq $categories) }}
            <option value="{{ . }}">{{ . }}</option>
          {{ end }}
        </select>
      </div>

      <!-- Tag Filter -->
      <div class="select-group">
        <span class="select-label">Tag:</span>
        <select id="tag-filter" class="custom-select">
          <option value="">All Tags</option>
          {{ $allTags := slice }}
          {{ range .Pages }}
            {{ with .Params.tags }}
              {{ $allTags = $allTags | append . }}
            {{ end }}
          {{ end }}
          {{ range sort (uniq $allTags) }}
            <option value="{{ . }}">{{ . }}</option>
          {{ end }}
        </select>
      </div>

      <!-- Sort Order -->
      <div class="select-group">
        <span class="select-label">Sort:</span>
        <select id="sort-filter" class="custom-select">
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
        </select>
      </div>
    </div>
  </div>
</section>

<!-- Blog Section -->
<section class="blog-section">
  <div class="container">
    <div class="blog-layout">

      <!-- Blog Grid -->
      <div class="blog-grid" id="blog-grid">
        {{ range .Pages }}
          <a href="{{ .RelPermalink }}" class="blog-card-link">
            <article class="blog-card" data-title="{{ .Title | lower }}" data-category="{{ with .Params.category }}{{ . }}{{ end }}" data-tags="{{ with .Params.tags }}{{ delimit . "," }}{{ end }}" data-date="{{ .Date.Format "2006-01-02" }}">
              <div class="blog-content">
                {{ with .Params.category }}
                  <span class="blog-category">{{ . }}</span>
                {{ end }}
                <h2 class="blog-title">{{ .Title }}</h2>
                <p class="blog-meta">
                  {{ with .Params.author }}{{ . }} | {{ end }}
                  {{ .Date.Format "January 2, 2006" }}
                </p>
                {{ with .Params.tags }}
                  <div class="blog-tags">
                    {{ range first 3 . }}
                      <span class="blog-tag">#{{ . }}</span>
                    {{ end }}
                  </div>
                {{ end }}
                <p class="blog-description">
                  {{ with .Params.description }}{{ . | truncate 120 }}{{ else }}{{ $.Summary | truncate 120 }}{{ end }}
                </p>
                <span class="read-more-btn">Read More</span>
              </div>
            </article>
          </a>
        {{ end }}
      </div>

      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="newsletter-card">
          <h3 class="newsletter-title">Join Our Newsletter</h3>
          <p class="newsletter-description">
            Get exclusive insights, show news and more delivered to your inbox.
          </p>

          <form action="https://securitycocktailhour.us4.list-manage.com/subscribe/post?u=5a12cbfb41bc7e9e08b7af3c6&amp;id=2eddec8bf9&amp;f_id=0098d0edf0" method="POST" target="_blank" class="newsletter-form">
            <input
              type="email"
              name="EMAIL"
              placeholder="Your email address"
              required
              class="newsletter-input-blog"
            >
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
              <input type="text" name="b_5a12cbfb41bc7e9e08b7af3c6_2eddec8bf9" tabindex="-1" value="">
            </div>
            <button type="submit" name="subscribe" class="newsletter-button">
              Subscribe
            </button>
          </form>

          <p class="newsletter-privacy">
            We respect your privacy. Unsubscribe at any time.
          </p>
        </div>
      </aside>

    </div>

    <!-- No Results Message -->
    <div id="no-results" style="display: none; text-align: center; padding: 3rem 0; width: 100%; max-width: 600px; margin: 0 auto;">
      <p style="font-size: 1.25rem; color: rgba(45, 45, 45, 0.6); margin-bottom: 1.5rem;">No blog posts found matching your search.</p>
      <button onclick="resetFilters()" class="btn btn-secondary">Clear Filters</button>
    </div>
  </div>
</section>

{{ end }}

{{ define "scripts" }}
<script>
// Blog search and filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('blog-search');
  const categoryFilter = document.getElementById('category-filter');
  const tagFilter = document.getElementById('tag-filter');
  const sortFilter = document.getElementById('sort-filter');
  const blogGrid = document.getElementById('blog-grid');
  const noResults = document.getElementById('no-results');

  function filterArticles() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedCategory = categoryFilter.value;
    const selectedTag = tagFilter.value;
    const sortOrder = sortFilter.value;

    const articleLinks = Array.from(blogGrid.querySelectorAll('.blog-card-link'));
    let visibleCount = 0;

    articleLinks.forEach(link => {
      const article = link.querySelector('.blog-card');
      const title = article.dataset.title || '';
      const category = article.dataset.category || '';
      const tags = article.dataset.tags || '';

      const matchesSearch = title.includes(searchTerm);
      const matchesCategory = !selectedCategory || category === selectedCategory;
      const matchesTag = !selectedTag || tags.toLowerCase().includes(selectedTag.toLowerCase());

      if (matchesSearch && matchesCategory && matchesTag) {
        link.style.display = '';
        visibleCount++;
      } else {
        link.style.display = 'none';
      }
    });

    // Sort articles
    const visibleArticles = articleLinks.filter(link => link.style.display !== 'none');
    visibleArticles.sort((a, b) => {
      const articleA = a.querySelector('.blog-card');
      const articleB = b.querySelector('.blog-card');
      const dateA = new Date(articleA.dataset.date);
      const dateB = new Date(articleB.dataset.date);
      return sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
    });

    visibleArticles.forEach(link => blogGrid.appendChild(link));

    // Show/hide no results message
    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
  }

  searchInput.addEventListener('input', filterArticles);
  categoryFilter.addEventListener('change', filterArticles);
  tagFilter.addEventListener('change', filterArticles);
  sortFilter.addEventListener('change', filterArticles);

  window.resetFilters = function() {
    searchInput.value = '';
    categoryFilter.value = '';
    tagFilter.value = '';
    sortFilter.value = 'newest';
    filterArticles();
  };
});
</script>
{{ end }}
