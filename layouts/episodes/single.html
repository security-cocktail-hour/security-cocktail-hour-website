{{ define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end }}

{{ define "head" }}
<!-- Podcast Episode Schema Markup -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "PodcastEpisode",
  "url": "{{ .Permalink }}",
  "name": "{{ .Title }}",
  "datePublished": "{{ .Date.Format "2006-01-02" }}",
  {{ with .Params.duration }}"timeRequired": "{{ . }}",{{ end }}
  "description": "{{ with .Description }}{{ . }}{{ else }}{{ .Summary }}{{ end }}",
  {{ with .Params.platforms.youtube }}
  "associatedMedia": {
    "@type": "MediaObject",
    "contentUrl": "{{ . }}"
  },
  {{ end }}
  "partOfSeries": {
    "@type": "PodcastSeries",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}"
  }
}
</script>
{{ end }}

{{ define "main" }}

<!-- Episode Header -->
<section class="section" style="background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%); color: white; padding: 2rem 0;">
  <div class="container">
    <nav aria-label="Breadcrumb" style="margin-bottom: 1rem; font-size: 0.875rem;">
      <a href="{{ "/" | relURL }}" style="color: rgba(255, 255, 255, 0.8);">Home</a> &gt;
      <a href="{{ "episodes" | relURL }}" style="color: rgba(255, 255, 255, 0.8);">Episodes</a> &gt;
      <span style="color: white;">{{ .Title }}</span>
    </nav>

    <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
      {{ with .File }}
        {{ $filename := .BaseFileName }}
        {{ if strings.HasPrefix $filename "episode-" }}
          {{ $parts := split $filename "-" }}
          {{ $epNum := index $parts 1 }}
          <span class="category-tag" style="background: rgba(255, 255, 255, 0.3);">Episode {{ $epNum }}</span>
        {{ end }}
      {{ end }}
      {{ with .Params.category }}
        <span class="category-tag" style="background: rgba(255, 255, 255, 0.2);">{{ . }}</span>
      {{ end }}
    </div>

    <h1 style="color: white; margin-bottom: 1rem;">{{ .Title }}</h1>

    <p style="font-size: 1.125rem; margin-bottom: 1.5rem; opacity: 0.95;">
      {{ with .Params.guest }}<strong>{{ . }}</strong> | {{ end }}
      {{ .Date.Format "January 2, 2006" }}
      {{ with .Params.duration }} | {{ . }}{{ end }}
    </p>

    <!-- Listen On Buttons -->
    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
      {{ with .Params.platforms.youtube }}
        <a href="{{ . }}" class="btn btn-primary" target="_blank" rel="noopener" style="background: #FF0000;">YouTube</a>
      {{ end }}
      {{ with .Params.platforms.spotify }}
        <a href="{{ . }}" class="btn btn-primary" target="_blank" rel="noopener" style="background: #1DB954;">Spotify</a>
      {{ end }}
      {{ with .Params.platforms.apple }}
        <a href="{{ . }}" class="btn btn-primary" target="_blank" rel="noopener" style="background: #9933CC;">Apple</a>
      {{ end }}
      {{ with .Params.platforms.amazon }}
        <a href="{{ . }}" class="btn btn-primary" target="_blank" rel="noopener" style="background: #FF9900;">Amazon</a>
      {{ end }}
    </div>
  </div>
</section>

<!-- Main Content with Sidebar -->
<section class="section">
  <div class="container">
    <div style="display: grid; grid-template-columns: 1fr; gap: 2rem;">

      <!-- Main Content Column -->
      <div style="grid-column: 1;">

        <!-- Episode Cover Image -->
        {{ with .Params.image }}
          <img src="{{ . | relURL }}" alt="{{ $.Title }}" style="width: 100%; max-width: 600px; border-radius: 8px; margin-bottom: 2rem;">
        {{ end }}

        <!-- Episode Description -->
        <div style="margin-bottom: 2rem;">
          {{ .Content }}
        </div>

        <!-- Social Sharing -->
        <div style="border-top: 1px solid #E5E5E5; padding-top: 1.5rem; margin-top: 2rem;">
          <h4>Share This Episode</h4>
          <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <a href="https://twitter.com/intent/tweet?text={{ .Title | urlquery }}&url={{ .Permalink | urlquery }}" target="_blank" rel="noopener" class="btn btn-secondary">Twitter</a>
            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ .Permalink | urlquery }}" target="_blank" rel="noopener" class="btn btn-secondary">LinkedIn</a>
            <a href="mailto:?subject={{ .Title | urlquery }}&body={{ .Permalink | urlquery }}" class="btn btn-secondary">Email</a>
          </div>
        </div>

      </div>

      <!-- Sidebar Column (Desktop) -->
      <aside style="grid-column: 1;">

        <!-- Guest Bio Card (if guest info exists) -->
        {{ with .Params.guest_bio }}
          <div class="card" style="margin-bottom: 2rem; background: #F5F5F5;">
            <div class="card-content">
              <h4>About {{ $.Params.guest }}</h4>
              {{ with $.Params.guest_image }}
                <img src="{{ . | relURL }}" alt="{{ $.Params.guest }}" style="width: 100px; height: 100px; border-radius: 50%; margin: 1rem 0;">
              {{ end }}
              <p style="font-size: 0.875rem;">{{ . | markdownify }}</p>
              {{ with $.Params.guest_links }}
                <div style="margin-top: 1rem;">
                  {{ range . }}
                    <a href="{{ .url }}" target="_blank" rel="noopener" style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem;">{{ .name }}</a>
                  {{ end }}
                </div>
              {{ end }}
            </div>
          </div>
        {{ end }}

        <!-- Email Signup -->
        <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%); color: white;">
          <div class="card-content">
            <h4 style="color: white;">Join Our Newsletter</h4>
            <p style="font-size: 0.875rem; margin-bottom: 1rem;">
              Get exclusive insights, show news and more delivered to your inbox.
            </p>
            <form action="#" method="POST">
              <input
                type="email"
                name="email"
                placeholder="Your email"
                required
                style="width: 100%; margin-bottom: 0.5rem;"
              >
              <button type="submit" class="btn btn-primary" style="width: 100%; background: white; color: #436098;">
                Subscribe
              </button>
            </form>
          </div>
        </div>

        <!-- Related Episodes -->
        <div>
          <h4>Related Episodes</h4>
          <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
            {{ $related := where .Site.RegularPages "Type" "episodes" | intersect (where .Site.RegularPages ".Params.category" .Params.category) | first 3 }}
            {{ range $related }}
              {{ if ne .Permalink $.Permalink }}
                <a href="{{ .Permalink }}" class="card" style="text-decoration: none; display: block;">
                  <div style="display: flex; gap: 1rem; padding: 1rem;">
                    {{ with .Params.image }}
                      <img src="{{ . | relURL }}" alt="{{ $.Title }}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 4px;">
                    {{ end }}
                    <div>
                      <p style="font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem; color: #436098;">{{ .Title }}</p>
                      <p style="font-size: 0.75rem; color: rgba(45, 45, 45, 0.7);">
                        {{ with .Params.guest }}{{ . }} | {{ end }}
                        {{ with .Params.duration }}{{ . }}{{ end }}
                      </p>
                    </div>
                  </div>
                </a>
              {{ end }}
            {{ end }}
          </div>
        </div>

      </aside>

    </div>
  </div>
</section>

<!-- Responsive Grid for Desktop -->
<style>
@media (min-width: 900px) {
  .container > div {
    grid-template-columns: 2fr 1fr !important;
  }
  .container > div > div:first-child {
    grid-column: 1 !important;
  }
  .container > div > aside {
    grid-column: 2 !important;
  }
}
</style>

{{ end }}
