{{ define "title" }}Cybersecurity Podcast Episodes | Security Cocktail Hour{{ end }}

{{ define "main" }}

<!-- Page Header -->
<section class="section" style="background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%); color: white; padding: 3rem 0;">
  <div class="container">
    <h1 style="color: white;">All Episodes</h1>
    <p style="font-size: 1.125rem; max-width: 600px;">
      Browse our complete archive of conversations with cybersecurity practitioners
      covering the full breadth of the field.
    </p>
  </div>
</section>

<!-- Search and Filters -->
<div style="background: white; border-bottom: 1px solid #E5E5E5; padding: 1rem 0;">
  <div class="container">
    <div style="display: flex; gap: 0.75rem; align-items: center; justify-content: space-between; flex-wrap: wrap;">
      <div style="position: relative; flex: 1; min-width: 200px; max-width: 400px;">
        <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 14px; height: 14px; color: #8D99AE; pointer-events: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <input
          type="search"
          id="episode-search"
          placeholder="Search episodes..."
          style="width: 100%; padding: 6px 10px 6px 32px; font-size: 0.8125rem; border: none; border-bottom: 1px solid #E5E5E5; background: transparent; color: #192A56; transition: border-color 0.2s;"
          onfocus="this.style.borderBottomColor='#436098'"
          onblur="this.style.borderBottomColor='#E5E5E5'"
        >
      </div>
      <div style="display: flex; gap: 0.75rem; align-items: center;">
        <select id="category-filter" style="padding: 6px 24px 6px 10px; font-size: 0.8125rem; border: none; border-bottom: 1px solid #E5E5E5; background: transparent; color: #192A56; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg width=%2710%27 height=%276%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3cpath d=%27M0 0l5 6 5-6z%27 fill=%27%238D99AE%27/%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 6px center;">
          <option value="">Topic</option>
          {{ $categories := slice }}
          {{ range .Pages }}
            {{ with .Params.category }}
              {{ $categories = $categories | append . }}
            {{ end }}
          {{ end }}
          {{ range sort (uniq $categories) }}
            <option value="{{ . }}">{{ . }}</option>
          {{ end }}
        </select>
        <select id="sort-filter" style="padding: 6px 24px 6px 10px; font-size: 0.8125rem; border: none; border-bottom: 1px solid #E5E5E5; background: transparent; color: #192A56; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg width=%2710%27 height=%276%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3cpath d=%27M0 0l5 6 5-6z%27 fill=%27%238D99AE%27/%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 6px center;">
          <option value="newest">Newest</option>
          <option value="oldest">Oldest</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- Episodes Grid -->
<section class="section">
  <div class="container">
    <div class="grid grid-3" id="episodes-grid">
      {{ range .Pages }}
        <article class="card episode-card" data-title="{{ .Title | lower }}" data-guest="{{ with .Params.guest }}{{ . | lower }}{{ end }}" data-category="{{ with .Params.category }}{{ . }}{{ end }}" data-date="{{ .Date.Format "2006-01-02" }}">
          {{ with .Params.image }}
            <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="card-image" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="card-image" style="background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%); display: none;"></div>
          {{ else }}
            <div class="card-image" style="background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%);"></div>
          {{ end }}
          <div class="card-content">
            {{ with .Params.category }}
              <span class="category-tag">{{ . }}</span>
            {{ end }}
            <h3 class="card-title">{{ .Title }}</h3>
            <p class="card-meta">
              {{ with .Params.guest }}{{ . }} | {{ end }}
              {{ with .Params.duration }}{{ . }}{{ end }}
            </p>
            <p class="card-meta" style="font-size: 0.75rem;">
              {{ .Date.Format "January 2, 2006" }}
            </p>
            <p class="card-description">{{ with .Params.description }}{{ . | truncate 120 }}{{ else }}{{ $.Summary | truncate 120 }}{{ end }}</p>
            <a href="{{ .RelPermalink }}" class="btn btn-primary">Listen Now</a>
          </div>
        </article>
      {{ end }}
    </div>

    <!-- No Results Message -->
    <div id="no-results" style="display: none; text-align: center; padding: 3rem 0;">
      <p style="font-size: 1.25rem; color: rgba(45, 45, 45, 0.6);">No episodes found matching your search.</p>
      <button onclick="resetFilters()" class="btn btn-secondary" style="margin-top: 1rem;">Clear Filters</button>
    </div>
  </div>
</section>

{{ end }}

{{ define "scripts" }}
<script>
// Simple client-side search and filter
const searchInput = document.getElementById('episode-search');
const categoryFilter = document.getElementById('category-filter');
const sortFilter = document.getElementById('sort-filter');
const episodesGrid = document.getElementById('episodes-grid');
const noResults = document.getElementById('no-results');
const episodes = Array.from(document.querySelectorAll('.episode-card'));

function filterEpisodes() {
  const searchTerm = searchInput.value.toLowerCase();
  const selectedCategory = categoryFilter.value;
  let visibleCount = 0;

  episodes.forEach(episode => {
    const title = episode.dataset.title;
    const guest = episode.dataset.guest;
    const category = episode.dataset.category;

    const matchesSearch = !searchTerm || title.includes(searchTerm) || guest.includes(searchTerm);
    const matchesCategory = !selectedCategory || category === selectedCategory;

    if (matchesSearch && matchesCategory) {
      episode.style.display = '';
      visibleCount++;
    } else {
      episode.style.display = 'none';
    }
  });

  // Show/hide no results message
  if (visibleCount === 0) {
    episodesGrid.style.display = 'none';
    noResults.style.display = 'block';
  } else {
    episodesGrid.style.display = 'grid';
    noResults.style.display = 'none';
  }
}

function sortEpisodes() {
  const sortValue = sortFilter.value;
  const sortedEpisodes = [...episodes].sort((a, b) => {
    const dateA = new Date(a.dataset.date);
    const dateB = new Date(b.dataset.date);
    return sortValue === 'newest' ? dateB - dateA : dateA - dateB;
  });

  sortedEpisodes.forEach(episode => episodesGrid.appendChild(episode));
}

function resetFilters() {
  searchInput.value = '';
  categoryFilter.value = '';
  sortFilter.value = 'newest';
  filterEpisodes();
  sortEpisodes();
}

searchInput.addEventListener('input', filterEpisodes);
categoryFilter.addEventListener('change', filterEpisodes);
sortFilter.addEventListener('change', sortEpisodes);
</script>
{{ end }}
