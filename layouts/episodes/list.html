{{ define "title" }}Cybersecurity Podcast Episodes | Security Cocktail Hour{{ end }}

{{ define "main" }}

<!-- Episodes Hero - Compact -->
<section class="episodes-hero">
  <div class="art-deco-pattern"></div>
  <div class="corner-accent corner-accent-tl"></div>
  <div class="corner-accent corner-accent-tr"></div>

  <div class="container">
    <div class="hero-content">
      <h1 class="hero-title">All <span>Episodes</span></h1>
      <p class="hero-subtitle">
        Browse our complete archive of conversations with cybersecurity practitioners
        covering the full breadth of the field.
      </p>

      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-number">{{ len .Pages }}</div>
          <div class="stat-label">Episodes</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">50+</div>
          <div class="stat-label">Guests</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">60hrs</div>
          <div class="stat-label">Content</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Controls Section -->
<section class="controls-section">
  <div class="container">
    <div class="controls-grid">
      <div class="search-container">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <input
          type="search"
          id="episode-search"
          class="search-input"
          placeholder="Search episodes, guests, topics..."
        >
      </div>

      <div class="select-group">
        <select id="category-filter" class="custom-select">
          <option value="">All Topics</option>
          {{ $categories := slice }}
          {{ range .Pages }}
            {{ with .Params.category }}
              {{ $categories = $categories | append . }}
            {{ end }}
          {{ end }}
          {{ range sort (uniq $categories) }}
            <option value="{{ . }}">{{ . }}</option>
          {{ end }}
        </select>

        <select id="sort-filter" class="custom-select">
          <option value="newest">Newest</option>
          <option value="oldest">Oldest</option>
        </select>
      </div>
    </div>
  </div>
</section>

<!-- Episodes Grid -->
<section class="episodes-section">
  <div class="container">
    <div class="episodes-grid" id="episodes-grid">
      {{ range .Pages }}
        {{ $episodeNum := "" }}
        {{ $filename := .File.BaseFileName }}
        {{ if hasPrefix $filename "episode-" }}
          {{ $parts := split (strings.TrimPrefix "episode-" $filename) "-" }}
          {{ $episodeNum = index $parts 0 }}
        {{ end }}

        <a href="{{ .RelPermalink }}" class="episode-card-link">
          <article class="episode-card" data-title="{{ .Title | lower }}" data-guest="{{ with .Params.guest }}{{ . | lower }}{{ end }}" data-category="{{ with .Params.category }}{{ . }}{{ end }}" data-date="{{ .Date.Format "2006-01-02" }}" data-episode="{{ $episodeNum }}">

            <!-- Episode Image with 16:9 ratio -->
            <div class="episode-image-container">
              {{ with .Params.image }}
                <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="episode-image" loading="lazy">
              {{ else }}
                <div class="episode-image"></div>
              {{ end }}
            </div>

            <!-- Episode Content -->
            <div class="episode-content">
              {{ with .Params.category }}
                <span class="episode-category">{{ . }}</span>
              {{ end }}

              <h3 class="episode-title">{{ .Title }}</h3>

              <div class="episode-meta">
                <div>{{ with .Params.guest }}{{ . }}{{ with $.Params.duration }} | {{ . }}{{ end }}{{ else }}{{ with .Params.duration }}{{ . }}{{ end }}{{ end }}</div>
                <div>{{ if $episodeNum }}Episode {{ $episodeNum }} | {{ end }}{{ .Date.Format "January 2, 2006" }}</div>
              </div>

              <p class="episode-description">
                {{ with .Params.description }}{{ . | truncate 150 }}{{ else }}{{ $.Summary | truncate 150 }}{{ end }}
              </p>

              <span class="episode-cta">Listen Now</span>
            </div>
          </article>
        </a>
      {{ end }}
    </div>

    <!-- No Results Message -->
    <div id="no-results" style="display: none; text-align: center; padding: 3rem 0; width: 100%; max-width: 600px; margin: 0 auto;">
      <p style="font-size: 1.25rem; color: rgba(45, 45, 45, 0.6); margin-bottom: 1.5rem;">No episodes found matching your search.</p>
      <button onclick="resetFilters()" class="btn btn-secondary">Clear Filters</button>
    </div>
  </div>
</section>

<script>
// Episode search and filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('episode-search');
  const categoryFilter = document.getElementById('category-filter');
  const sortFilter = document.getElementById('sort-filter');
  const episodesGrid = document.getElementById('episodes-grid');
  const noResults = document.getElementById('no-results');

  function filterEpisodes() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedCategory = categoryFilter.value;
    const sortOrder = sortFilter.value;

    const episodeLinks = Array.from(episodesGrid.querySelectorAll('.episode-card-link'));
    let visibleCount = 0;

    episodeLinks.forEach(link => {
      const episode = link.querySelector('.episode-card');
      const title = episode.dataset.title || '';
      const guest = episode.dataset.guest || '';
      const category = episode.dataset.category || '';
      const episodeNum = episode.dataset.episode || '';

      const matchesSearch = title.includes(searchTerm) ||
                           guest.includes(searchTerm) ||
                           episodeNum.includes(searchTerm);
      const matchesCategory = !selectedCategory || category === selectedCategory;

      if (matchesSearch && matchesCategory) {
        link.style.display = '';
        visibleCount++;
      } else {
        link.style.display = 'none';
      }
    });

    // Sort episodes
    const visibleEpisodes = episodeLinks.filter(link => link.style.display !== 'none');
    visibleEpisodes.sort((a, b) => {
      const episodeA = a.querySelector('.episode-card');
      const episodeB = b.querySelector('.episode-card');
      const dateA = new Date(episodeA.dataset.date);
      const dateB = new Date(episodeB.dataset.date);
      return sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
    });

    visibleEpisodes.forEach(link => episodesGrid.appendChild(link));

    // Show/hide no results message
    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
  }

  searchInput.addEventListener('input', filterEpisodes);
  categoryFilter.addEventListener('change', filterEpisodes);
  sortFilter.addEventListener('change', filterEpisodes);

  window.resetFilters = function() {
    searchInput.value = '';
    categoryFilter.value = '';
    sortFilter.value = 'newest';
    filterEpisodes();
  };
});
</script>

{{ end }}
