{{ define "title" }}Cybersecurity Podcast Episodes | Security Cocktail Hour{{ end }}

{{ define "main" }}

<!-- Page Header -->
<section class="section" style="background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%); color: white; padding: 3rem 0;">
  <div class="container">
    <h1 style="color: white;">All Episodes</h1>
    <p style="font-size: 1.125rem; max-width: 600px;">
      Browse our complete archive of conversations with cybersecurity practitioners
      covering the full breadth of the field.
    </p>
  </div>
</section>

<!-- Search and Filters -->
<section class="section" style="padding: 2rem 0; background: #F5F5F5;">
  <div class="container">
    <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
      <input
        type="search"
        id="episode-search"
        placeholder="🔍 Search episodes by title, guest, or topic..."
        style="flex: 1; min-width: 300px; padding: 12px 16px; border-radius: 8px; border: 1px solid #D0D0D0;"
      >
      <select id="category-filter" style="padding: 12px 16px; border-radius: 8px; border: 1px solid #D0D0D0;">
        <option value="">All Topics</option>
        {{ $categories := slice }}
        {{ range .Pages }}
          {{ with .Params.category }}
            {{ $categories = $categories | append . }}
          {{ end }}
        {{ end }}
        {{ range sort (uniq $categories) }}
          <option value="{{ . }}">{{ . }}</option>
        {{ end }}
      </select>
      <select id="sort-filter" style="padding: 12px 16px; border-radius: 8px; border: 1px solid #D0D0D0;">
        <option value="newest">Newest First</option>
        <option value="oldest">Oldest First</option>
      </select>
    </div>
  </div>
</section>

<!-- Episodes Grid -->
<section class="section">
  <div class="container">
    <div class="grid grid-3" id="episodes-grid">
      {{ range .Pages }}
        <article class="card episode-card" data-title="{{ .Title | lower }}" data-guest="{{ with .Params.guest }}{{ . | lower }}{{ end }}" data-category="{{ with .Params.category }}{{ . }}{{ end }}" data-date="{{ .Date.Format "2006-01-02" }}">
          {{ with .Params.image }}
            <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="card-image" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="card-image" style="background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%); display: none;"></div>
          {{ else }}
            <div class="card-image" style="background: linear-gradient(135deg, #436098 0%, #6A8CC7 100%);"></div>
          {{ end }}
          <div class="card-content">
            {{ with .Params.category }}
              <span class="category-tag">{{ . }}</span>
            {{ end }}
            <h3 class="card-title">{{ .Title }}</h3>
            <p class="card-meta">
              {{ with .Params.guest }}{{ . }} | {{ end }}
              {{ with .Params.duration }}{{ . }}{{ end }}
            </p>
            <p class="card-meta" style="font-size: 0.75rem;">
              {{ .Date.Format "January 2, 2006" }}
            </p>
            <p class="card-description">{{ with .Params.description }}{{ . | truncate 120 }}{{ else }}{{ $.Summary | truncate 120 }}{{ end }}</p>
            <a href="{{ .RelPermalink }}" class="btn btn-primary">Listen Now</a>
          </div>
        </article>
      {{ end }}
    </div>

    <!-- No Results Message -->
    <div id="no-results" style="display: none; text-align: center; padding: 3rem 0;">
      <p style="font-size: 1.25rem; color: rgba(45, 45, 45, 0.6);">No episodes found matching your search.</p>
      <button onclick="resetFilters()" class="btn btn-secondary" style="margin-top: 1rem;">Clear Filters</button>
    </div>
  </div>
</section>

{{ end }}

{{ define "scripts" }}
<script>
// Simple client-side search and filter
const searchInput = document.getElementById('episode-search');
const categoryFilter = document.getElementById('category-filter');
const sortFilter = document.getElementById('sort-filter');
const episodesGrid = document.getElementById('episodes-grid');
const noResults = document.getElementById('no-results');
const episodes = Array.from(document.querySelectorAll('.episode-card'));

function filterEpisodes() {
  const searchTerm = searchInput.value.toLowerCase();
  const selectedCategory = categoryFilter.value;
  let visibleCount = 0;

  episodes.forEach(episode => {
    const title = episode.dataset.title;
    const guest = episode.dataset.guest;
    const category = episode.dataset.category;

    const matchesSearch = !searchTerm || title.includes(searchTerm) || guest.includes(searchTerm);
    const matchesCategory = !selectedCategory || category === selectedCategory;

    if (matchesSearch && matchesCategory) {
      episode.style.display = '';
      visibleCount++;
    } else {
      episode.style.display = 'none';
    }
  });

  // Show/hide no results message
  if (visibleCount === 0) {
    episodesGrid.style.display = 'none';
    noResults.style.display = 'block';
  } else {
    episodesGrid.style.display = 'grid';
    noResults.style.display = 'none';
  }
}

function sortEpisodes() {
  const sortValue = sortFilter.value;
  const sortedEpisodes = [...episodes].sort((a, b) => {
    const dateA = new Date(a.dataset.date);
    const dateB = new Date(b.dataset.date);
    return sortValue === 'newest' ? dateB - dateA : dateA - dateB;
  });

  sortedEpisodes.forEach(episode => episodesGrid.appendChild(episode));
}

function resetFilters() {
  searchInput.value = '';
  categoryFilter.value = '';
  sortFilter.value = 'newest';
  filterEpisodes();
  sortEpisodes();
}

searchInput.addEventListener('input', filterEpisodes);
categoryFilter.addEventListener('change', filterEpisodes);
sortFilter.addEventListener('change', sortEpisodes);
</script>
{{ end }}
